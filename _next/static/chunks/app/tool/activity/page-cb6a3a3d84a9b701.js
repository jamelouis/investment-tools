(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[868],{92329:function(t,e,a){Promise.resolve().then(a.bind(a,23689))},23689:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return g}});var l=a(11601),r=a(6459),n=a(25357),s=t=>{let{data:e,mark:a,onMarkClicked:s,range:o}=t,c=(0,r.useRef)(null),[d,i]=(0,r.useState)(o);return(0,r.useEffect)(()=>{o&&2===o.length&&(i(o),console.log(o))},[o]),(0,r.useEffect)(()=>{let t=n.Ys(c.current);t.selectAll("*").remove(),t.attr("viewBox",[0,0,1080,300]).attr("style","max-width: 100%; height: auto;");let l=n.Xf().range([0,990]),r=n.Xf().range([0,990]),s=n.BYU().range([170,0]),o=n.BYU().range([40,0]);l.domain(n.Wem(e,t=>t.date)),s.domain([0,n.Fp7(e,t=>t.value)]),r.domain(l.domain()),o.domain(s.domain()),t.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",990).attr("height",170);let i=t.append("g").attr("transform","translate(".concat(60,",").concat(20,")")),u=t.append("g").attr("transform","translate(".concat(60,",").concat(230,")")),p=n.jvg().x(t=>l(t.date)).y(t=>s(t.value)),m=n.jvg().x(t=>r(t.date)).y(t=>o(t.value));i.append("path").datum(e).attr("class","line").attr("clip-path","url(#clip)").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",p),u.append("path").datum(e).attr("class","line").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",m),i.selectAll(".dot").data(a).enter().append("circle").attr("class","dot").attr("clip-path","url(#clip)").attr("cx",t=>l(t.date)).attr("cy",t=>s(t.value)).attr("r",3.5).attr("fill","steelblue").on("mouseover",(t,e)=>{let a=n.Ys("body").append("div").attr("class","tooltip").style("position","absolute").style("background-color","white").style("border","1px solid #ddd").style("padding","10px").style("opacity",0);a.transition().duration(200).style("opacity",.9),a.html("\uD83D\uDCC5: ".concat(n.i$Z("%Y-%m-%d")(e.date)," <br/>数值: ").concat(e.value," <br/> 点击查看发车文章")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",()=>{n.Ys(".tooltip").remove()}).on("click",(t,e)=>{e.url&&window.open(e.url,"_blank")}),i.append("g").attr("class","axis axis--x").attr("transform","translate(0,".concat(170,")")).call(n.LLu(l).tickFormat(n.i$Z("%Y-%m-%d"))),i.append("g").attr("class","axis axis--y").call(n.y4O(s)),u.append("g").attr("class","axis axis--x").attr("transform","translate(0,".concat(40,")")).call(n.LLu(r));let f=n.Yud().extent([[0,0],[990,40]]).on("end",function(t){if(t.sourceEvent&&"zoom"===t.sourceEvent.type)return;let e=t.selection||r.range();l.domain(e.map(r.invert,r)),i.select(".line").attr("d",p),i.selectAll(".dot").attr("cx",t=>l(t.date)).attr("cy",t=>s(t.value)),i.select(".axis--x").call(n.LLu(l).tickFormat(n.i$Z("%Y-%m-%d")))});u.append("g").attr("class","brush").call(f).call(f.move,d.map(t=>l(t)))},[o]),(0,l.jsx)("svg",{ref:c})};let o=(t,e)=>{let[a,l]=(0,r.useState)(null),[s,o]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{try{n.gyn(t,e).then(t=>l(t))}catch(t){o("Failed to fetch or parse CSV data")}})()},[t]),{data:a,error:s}},c=t=>{let e=Array.from(n.jJk(t,t=>n.Smz(t,t=>parseInt(t.tradeUnit)),t=>t.date.getFullYear(),t=>t.type),t=>{let[e,a]=t;return Array.from(a,t=>{let[a,l]=t;return{date:e,type:a,count:l}})}).flat();return e.sort((t,e)=>n.j2p(t.date,e.date)),e},d=t=>Array.from(n.jJk(t,t=>n.Smz(t,t=>parseInt(t.tradeUnit)),t=>n.i$Z("%Y-%m")(n.F0B(t.date)),t=>t.type),t=>{let[e,a]=t;return Array.from(a,t=>{let[a,l]=t;return{date:e,type:a,count:l}})}).flat(),i=t=>{let e=Array.from(new Set(t.map(t=>t.date))),a=Array.from(new Set(t.map(t=>t.type))),l=n.VV$(e,t=>new Date(t)),r=n.Fp7(e,t=>new Date(t));return n.K_h(n.F0B.floor(l),n.F0B.ceil(r)).map(t=>n.i$Z("%Y-%m")(t)).flatMap(t=>a.map(e=>({date:t,type:e}))).map(e=>t.find(t=>t.date===e.date&&t.type===e.type)||{...e,count:0})},u=t=>i(d(t)),p=t=>{let{data:e,enableBrush:a=!1,onBrushed:s=null,onClick:o=null}=t,c=(0,r.useRef)();return(0,r.useEffect)(()=>{if(e&&c.current){let t=n.Ys(c.current);t.selectAll("*").remove(),t.attr("viewBox",[0,0,928,500]).attr("style","max-height: 100%; width: auto;");let l=n.knu().keys(n.G0j(e.map(t=>t.type))).value((t,e)=>{let[,a]=t;return a.get(e)?a.get(e).count:0})(n.KzB(e,t=>t.date,t=>t.type)),r=n.tiA().domain(e.map(t=>t.date)).range([40,918]).padding(.1),d=n.BYU().domain([0,n.Fp7(l,t=>n.Fp7(t,t=>t[1]))]).rangeRound([440,10]);if(t.append("g").selectAll().data(l).join("g").attr("fill",t=>"buy"===t.key?"red":"green").selectAll("rect").data(t=>t.map(e=>(e.key=t.key,e))).join("rect").attr("x",t=>r(t.data[0])).attr("y",t=>d(t[1])).attr("height",t=>d(t[0])-d(t[1])).attr("width",r.bandwidth()).on("click",(t,e)=>{console.log(e.data[0]),o&&o(e.data[0])}).append("title").text(t=>{let e=t.data[1].get(t.key)?t.data[1].get(t.key).count:0;return"".concat(t.data[0]," ").concat(t.key," ").concat(e)}),t.append("g").attr("transform","translate(0,".concat(440,")")).call(n.LLu(r).tickValues(r.domain().filter(function(t,e){return!(e%3)}))).call(t=>t.selectAll(".domain").remove()).selectAll("text").attr("transform","rotate(-90)").attr("y",0).attr("x",-10).attr("dy",".35em").style("text-anchor","end"),t.append("g").attr("transform","translate(".concat(40,",0)")).call(n.y4O(d).ticks(null,"s")).call(t=>t.selectAll(".domain").remove()),a){let e=n.Yud().extent([[40,.5],[918,440.5]]).on("end",t=>{let{selection:e}=t;console.log(e);let a=e.map(t=>r.domain()[Math.max(0,Math.min(r.domain().length-1,Math.floor(t/r.step()-.5)))]);console.log(a),s&&s([a[0]-1,a[1]])});t.append("g").call(e)}}},[e]),(0,l.jsx)("svg",{ref:c})},m=(t,e)=>t.map(t=>{let a=e.find(e=>e.date.getTime()===t.date.getTime());return a?{date:a.date,value:a.value,url:t.articleLink}:null}).filter(t=>null!==t),f=t=>{let{activityData:e,onMarkClicked:a,range:r}=t,{data:n,error:c}=o("https://gist.githubusercontent.com/jamelouis/64cd7580e042da48d4f95836784951de/raw/1b86392e112a783cb901fcb9af4a8ae13ad08e10/399001.csv",t=>(t.date=new Date(t.date),t.value=+t.close,t));if(c)return(0,l.jsx)("p",{children:c});if(!n)return(0,l.jsx)("p",{children:"Loading..."});let d=m(e,n);return(0,l.jsx)(s,{data:n,mark:d,onMarkClicked:a,range:r})};function g(){let{data:t,error:e}=o("https://gist.githubusercontent.com/jamelouis/c4d5d513b9f6c3c4ff59675409ea209a/raw/0b13854c513a96e9403c540b5fa9ec4bf07af5be/etf150_transactions.csv",t=>(t.date=new Date(t.date),t.tradeUint=+t.tradeUnit,t)),[a,n]=(0,r.useState)(null),[s,d]=(0,r.useState)("https://qieman.com/alfa/portfolio/LONG_WIN/signal"),[i,m]=(0,r.useState)(!0),g=new Date().getFullYear(),h=new Date,[x,y]=(0,r.useState)([new Date(g,0,1),h]);if(e)return(0,l.jsx)("p",{children:e});if(!t)return(0,l.jsx)("p",{children:"Loading..."});let v=c(t),w=u(t),b=a?w.filter(t=>new Date(t.date)>new Date(a[0],11,31)&&new Date(t.date)<=new Date(a[1],11,31)):w;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"flex justify-center mb-[480px] ",children:[(0,l.jsxs)("div",{className:"flex-col w-8/12 mb-12",children:[(0,l.jsx)("h2",{className:"text-5xl text-center p-6",children:"长赢计划发车可视化"}),(0,l.jsx)(p,{data:v,enableBrush:!0,onBrushed:t=>n(t)}),(0,l.jsx)(p,{data:b,onClick:t=>{let e=t.split("-"),a=parseInt(e[0]),l=parseInt(e[1])-1,r=new Date(a,l,1),n=new Date(a,l+1,1);console.log(r,n),y([r,n])}})]}),(0,l.jsx)("div",{className:"fixed bottom-0 w-8/12 mt-10 mr-12 ml-10 ring-1 ",children:(0,l.jsxs)("div",{className:"bg-white shadow-lg rounded-lg",children:[(0,l.jsx)("button",{onClick:()=>m(!i),className:"w-full p-2 text-center bg-gray-200 hover:bg-gray-300 transition-colors duration-200",children:i?"Collapse":"Expand"}),i&&(0,l.jsx)("div",{className:"p-6",children:(0,l.jsx)(f,{activityData:t,onMarkClicked:d,range:x})})]})})]})})}}},function(t){t.O(0,[723,357,570,833,744],function(){return t(t.s=92329)}),_N_E=t.O()}]);